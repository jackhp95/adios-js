const e=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),t=e=>e.replace(/-./g,(e=>e.toUpperCase()[1])),r=(e,...t)=>[...new Set(e)].filter((e=>t.every((t=>t.includes(e))))),n=(e,t)=>t.split(".").reduce(((e,t)=>e&&e[t]),e),a=(e,t,r)=>t.split(".").reduce(((e={},t,n,{length:a})=>n+1===a?e[t]=r:e?.[t]),e),o=(e,t=new WeakMap)=>{if(Object(e)!==e)return e;if(t.has(e))return t.get(e);const r=e instanceof Set?new Set(e):e instanceof Map?new Map(Array.from(e,(([e,r])=>[e,o(r,t)]))):e instanceof Date?new Date(e):e instanceof RegExp?new RegExp(e.source,e.flags):e.constructor?new e.constructor:Object.create(null);return t.set(e,r),Object.assign(r,...Object.keys(e).map((r=>({[r]:o(e[r],t)}))))},s=e=>e&&"object"==typeof e&&!Array.isArray(e),l=(e,...t)=>{if(!t.length)return e;const r=t.shift();if(s(e)&&s(r))for(const t in r)s(r[t])?(e[t]||Object.assign(e,{[t]:{}}),l(e[t],r[t])):Object.assign(e,{[t]:r[t]});return l(e,...t)};function c(){var e=[],t=[],r=[],n=null,a=(o,s,l)=>{var c=s||null,i=l||[{target:o,property:""}];o instanceof Array&&(o.__length=o.length);var u=[],f=(e,t,r)=>{for(var n="",a=null,o=0;o<i.length;o++)a instanceof Array&&!isNaN(i[o].property)&&(i[o].property=a.indexOf(i[o].target)),n=n+"."+i[o].property,a=i[o].target;return n=(n=n+"."+t).substring(2),!0===r&&(n="/"+n.replace(/\./g,"/")),n},p=e=>{if(requestIdleCallback)requestIdleCallback((()=>{if(e===u.length){var t=[...u];u=[],c.observers.forEach((e=>e(t)))}}));else{var t=[...u];u=[],c.observers.forEach((e=>e(t)))}},h={get:(e,n)=>{if("__getTarget"===n)return e;if("__isProxy"===n)return!0;if("__getParent"===n)return e=>{if(void 0===e)e=1;var t=f(0,"__getParent").split(".");return t.splice(-(e+1),e+1),((e,t)=>t.split(".").reduce(((e,t)=>e?e[t]:void 0),e||self))(c.parentProxy,t.join("."))};if("__getPath"===n)return f(0,"__getParent").slice(0,-12);var o=e[n];if(e instanceof Date&&o instanceof Function&&null!==o)return o.bind(e);if(o instanceof Object&&null!==o&&e.hasOwnProperty(n)){if(!0===o.__isProxy&&(o=o.__getTarget),o.__targetPosition>-1&&null!==t[o.__targetPosition])for(var s=r[o.__targetPosition],l=0,u=s.length;l<u;l++)if(c===s[l].observable)return s[l].proxy;var p=[...i];return p.push({target:o,property:n}),a(o,c,p)}return o},deleteProperty:(e,a)=>{var o=!0;n===g&&(o=!1,n=null);var s=Object.assign({},e);if(u.push({type:"delete",target:e,property:a,newValue:null,previousValue:s[a],currentPath:f(0,a),jsonPointer:f(0,a,!0),proxy:g}),!0===o){c.changesPaused||delete e[a];for(var l=0,i=t.length;l<i&&e!==t[l];l++);for(var h=r[l]||[],d=h.length;d--;)h[d].proxy!==g&&(n=h[d].proxy,delete h[d].proxy[a])}return p(u.length),!0},set:(e,a,o,s)=>{o&&o.__isProxy&&(o=o.__getTarget);var l=!0;n===g&&(l=!1,n=null);var i=e[a];if(i!==o||!1===l||"length"===a&&e instanceof Array&&e.__length!==o){var h=!0,d=typeof i,v="update";if("undefined"===d&&(v="add"),u.push({type:v,target:e,property:a,newValue:o,previousValue:s[a],currentPath:f(0,a),jsonPointer:f(0,a,!0),proxy:g}),"length"===a&&e instanceof Array&&e.__length!==o&&(u[u.length-1].previousValue=e.__length,e.__length=o),!0===l){c.changesPaused||(e[a]=o),h=!1;for(var b=e.__targetPosition,y=r[b].length;y--;)if(c===r[b][y].observable&&null!==t[r[b][y].observable.parentTarget.__targetPosition]){h=!0;break}if(h){for(var _=r[b],m=0,j=_.length;m<j;m++)_[m].proxy!==g&&(n=_[m].proxy,_[m].proxy[a]=o);requestAnimationFrame((()=>setTimeout((()=>{if("object"===d&&null!==i){for(var n=Object.keys(e),a=0,o=n.length;a<o;a++)if(e[n[a]]===i)return;var s=!1;if(function e(t){for(var r=Object.keys(t),n=0,a=r.length;n<a;n++){var o=t[r[n]];if(o instanceof Object&&null!==o&&e(o),o===i)return void(s=!0)}}(e),!0===s)return;!function e(n){for(var a=Object.keys(n),o=0,s=a.length;o<s;o++){var l=n[a[o]];l instanceof Object&&null!==l&&e(l)}var i=-1;for(o=0,s=t.length;o<s;o++)if(n===t[o]){i=o;break}if(i>-1){for(var u=r[i],f=u.length;f--;)if(c===u[f].observable){u.splice(f,1);break}0==u.length&&(t[i]=null)}}(i)}}),0)))}}h&&p(u.length)}return!0}},d=o.__targetPosition;d>-1||Object.defineProperty(o,"__targetPosition",{value:t.length,writable:!1,enumerable:!1,configurable:!1});var g=new Proxy(o,h);null===c&&(c={parentTarget:o,parentProxy:g,observers:[],paused:!1,path:i,changesPaused:!1},e.push(c));var v={target:o,proxy:g,observable:c};return d>-1?(null===t[d]&&(t[d]=o),r[d].push(v)):(t.push(o),r.push([v])),g};return{create:function(e,t){if(!0===e.__isProxy)e=e.__getTarget;var r=a(e);return"function"==typeof t&&this.observe(r,t),function e(t){for(var r=t.__getTarget,n=Object.keys(r),a=0,o=n.length;a<o;a++){var s=n[a];r[s]instanceof Object&&null!==r[s]&&e(t[s])}}(r),r},observe:(t,r)=>{for(var n=e.length;n--;)if(e[n].parentProxy===t){e[n].observers.push(r);break}}}}const i=e=>({push:(t,r)=>()=>t[e]=r,pull:t=>t[e]||void 0}),u=e=>({push:(t,r={})=>{const n=t.dataset.each,a=Object.keys(r).filter((e=>!/^__/.exec(e))),o=t.parentElement,[s,l]=a.map((r=>{const a=t.content.firstElementChild.cloneNode(!0),o=[...a.querySelectorAll(e.util.selectors())];return[a,o.flatMap((t=>Object.entries(t.dataset).filter((([t,r])=>Object.keys(e.codecs).includes(t))).flatMap((([a,o])=>{const s=o.startsWith("~")?o.substring(1):`${n}.${r}.${o}`;return t.dataset[a]=s,e.codecs[a].push(t,e.resolver(s))}))))]})).reduce((([e,t],[r,n])=>[[...e,r],[...t,...n]]),[[],[]]);return()=>{[...o.children].filter((e=>e!==t)).forEach((e=>e.remove())),l.map((e=>e())),o.append(...s)}},pull:t=>{const n=t.dataset.each,o={},s=e.util.elements(n,!0),l=Object.keys(e.codecs).filter((e=>"each"!==e));return s.forEach((s=>{r(Object.keys(s.dataset),l).forEach((r=>{const l=e.codecs[r].pull(t),c=s.dataset[r].replace(n+".","");a(o,c,l)}))})),o}}),f=e=>({push:(t,r)=>()=>requestAnimationFrame((()=>{const r=e.resolver(t.dataset.src);if(!r)return console.log("No data-src resolved for data-inject to inject",{el:t,src:t.dataset.src,url:r}),()=>{};fetch(r).then((r=>r.text().catch(console.log).then((r=>{if(t?.nextElementSibling?.dataset?.injected)return;const n=document.createElement("div");n.classList.add(...t.classList),n.innerHTML=r,t.insertAdjacentElement("afterend",n),n.dataset.injected=!0,e.util.hide(t)}))))})),pull:e=>e?.nextElementSibling?.dataset?.injected&&e?.nextElementSibling?.outerHtml}),p=e=>{const t=typeof e;return"object"===t?(e=>{const t=e instanceof HTMLElement&&"element",r=e instanceof Node&&"element",n=e instanceof HTMLElement&&"array";return(null===e?"null":t)||r||n||"object"})(e):t},h=(e={})=>{const t=()=>Object.keys(e.codecs).map(r).join(","),r=t=>`[data-${e.util.asAttr(t)}]`,n=(t,r)=>Object.keys(e.codecs).map((n=>`[data-${e.util.asAttr(n)}${((e,t=!1)=>e?t?`^="${e}"`:`="${e}"`:"")(t,r)}]`)).join(","),a=e=>Object.values(e.dataset).map(n).join(","),o=(e=>(...t)=>e[p(t[0])](...t))({undefined:t,element:a,string:n,object:r}),s={element:a,path:n,codec:r,all:t};return e.util.selectors=Object.assign(o,s),e},d={is:{},config:{root:document}},g=[e=>(e.resolver=(...t)=>{const[r,o]=t;return{0:()=>console.error("resolver has no args."),1:()=>n(e.is,r),2:()=>a(e.is,r,o),3:()=>console.error("resolver has 3 or more args:",t)}[Math.min(t.length,3)]()},e),(r={})=>(r.util=r.util||{},r.util.asAttr=e,r.util.asProp=t,h(r),((e={})=>{const t=e?.config?.root||document,r=e.util.selectors,n={element:(...e)=>[...t.querySelectorAll(r.element(...e))],path:(...e)=>[...t.querySelectorAll(r.path(...e))],codec:(...e)=>[...t.querySelectorAll(r.codec(...e))],all:(...e)=>[...t.querySelectorAll(r.all(...e))]};e.util.elements=Object.assign(((...e)=>[...t.querySelectorAll(r(...e))]),n)})(r),r.util.hide=e=>e.hidden=!0,r.util.show=e=>e.hidden=!1,r),(e={})=>(e.codecs={text:i("textContent"),html:i("innerHTML"),href:i("href"),src:{push:(e,t)=>()=>{return("string"==typeof(r=t)||r instanceof String)&&t&&(e.src=t);var r},pull:e=>e.src||void 0},replace:i("outerHTML"),each:u(e),inject:f(e)},e)].reduce(((e,t)=>t(e)),d),v=()=>{},b=(e={},t=v,r=!1,s=!1,i=!1)=>{const u=n(e,r)||n(e,i)||{},f=((e={},t=v,r=[])=>c().create(e,t))(u,t);return i&&a(e,i,u),s&&a(e,s,((e,t)=>(...r)=>({0:()=>o(e),1:e=>l(e,t),2:(e,r)=>l(r,n(e,t))}[r.length](...r)))(u,f)),r&&a(e,r,f),f},y=e=>(t="")=>{console.log({path:t,be:e.be()});const r=e.util.elements(t,!0),n=t=>t in e.codecs;r.forEach((t=>Object.keys(t.dataset).filter(n).forEach((t=>r=>{const n=t.dataset[r]&&e.resolver(t.dataset[r]);void 0!==n&&queueMicrotask((()=>{const a=e.codecs[r].push(t,n);requestAnimationFrame(a)}))})(t))))},_=()=>{},m={subtree:!0,childList:!0,attributes:!0},j=(e=_)=>t=>t.forEach((t=>[t.target,...t.addedNodes].forEach((t=>Promise.resolve().then((()=>{return e((r=t)instanceof Element||r instanceof HTMLDocument?t:t.parentElement);var r})))))),O=(e=document,t=_,r=m)=>((e=_)=>new MutationObserver(j(e)))(t).observe(e,r),P=(e=g)=>(e.puller=(e=>t=>{r(Object.keys(t.dataset),Object.keys(e.codecs)).forEach((r=>{const n=t.dataset[r],a=(0,e.codecs[r].pull)(t);a===e.resolver(n)||e.resolver(n,a)}))})(e),e.pull=()=>e.util.elements().forEach(e.puller),e.domobs=O(document,e.puller,m),e.pull(),e),x=(e,t,r=(e=>e))=>(e=e||{},t.catch((t=>e.err=t)).then((t=>t.json().catch((t=>e.err=t)).then((e=>{return t=r(e),n=e,void 0===t?n:t;var t,n})).then((t=>e.ok=t)))).then(console.log),e),E=()=>((e=g)=>(e.pushSet=new Set,e.pusher=t=>t.forEach((({currentPath:t})=>y(e)(t))),e.push=y(e),b(e,e.pusher,"is","be","util.raw"),e))(P(g));export default E;export{E as Adios,x as Oath};
